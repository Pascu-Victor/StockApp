@page
@model StockAppWeb.Views.Pages.GemStoreModel
@{
    var vm = Model.ViewModel;
}

<div style="margin:20px; background:#081708;">
    <!-- Top Section -->
    <div style="background:#0a1a0a; height:70px; display:flex; align-items:center; justify-content:flex-end; padding:10px;">
        <span style="font-size:25px; font-weight:bold; color:white;">
            Gems: @vm.UserGems
        </span>
    </div>

    <!-- Main Content Section -->
    <div style="display:flex; margin-top:10px;">
        <!-- Buying Gems Section -->
        <div style="flex:3; margin-right:20px; background:#1a4919; padding:10px;">
            <div style="display:grid; grid-template-columns:200px 100px 100px 100px 75px; font-weight:bold; color:white; font-size:18px;">
                <span>Gems</span>
                <span>Price</span>
                <span>Expires At</span>
                <span></span>
                <span></span>
            </div>
            @foreach (var deal in vm.AvailableDeals)
            {
                <div style="background:#276b26; padding:10px; border-radius:10px; margin-top:10px; display:grid; grid-template-columns:200px 100px 100px 100px 75px; align-items:center;">
                    <span style="color:white; font-size:18px;">@deal.Title</span>
                    <span style="color:white; font-size:18px;">@deal.GemAmount</span>
                    <span style="color:white; font-size:18px;">@deal.FormattedPrice</span>
                    <span style="color:white; font-size:18px;">@deal.ExpirationTimeFormatted</span>
                    <form method="post" asp-page-handler="Buy" style="margin:0;">
                        <input type="hidden" name="dealTitle" value="@deal.Title" />
                        <select name="SelectedBankAccount">
                            <option value="">Select Account</option>
                            @foreach (var acc in vm.UserBankAccounts)
                            {
                                if (acc == vm.SelectedBankAccount)
                                {
                                    <option value="@acc" selected>@acc</option>
                                }
                                else
                                {
                                    <option value="@acc">@acc</option>
                                }
                            }
                        </select>

                        <button type="submit" class="btn" style="background:#5f815f; color:white; width:75px;">BUY</button>
                    </form>
                </div>
            }
            @if (!string.IsNullOrEmpty(vm.SuccessMessage))
            {
                <div style="color:green; margin-top:10px;">@vm.SuccessMessage</div>
            }
            @if (!string.IsNullOrEmpty(vm.ErrorMessage))
            {
                <div style="color:darkred; margin-top:10px;">@vm.ErrorMessage</div>
            }
        </div>

        <!-- Selling Gems Section -->
        <div style="flex:1; background:#5f815f; border-radius:10px; padding:10px; display:flex; flex-direction:column; align-items:center;">
            <span style="font-size:20px; font-weight:bold; color:white;">Sell Gems</span>
            <span style="color:white;">100 Gems = 1€</span>
            <form method="post" asp-page-handler="Sell" style="width:100%; display:flex; flex-direction:column; align-items:center;">
                <input type="number" name="GemsToSell" min="1" max="@vm.UserGems" placeholder="Enter amount" style="margin:5px 0; padding:10px; background:#1a4919; color:white; width:100%;" value="@vm.GemsToSell" />
                <select name="SelectedBankAccount">
                    <option value="">Select Account</option>
                    @foreach (var acc in vm.UserBankAccounts)
                    {
                        if (acc == vm.SelectedBankAccount)
                        {
                            <option value="@acc" selected>@acc</option>
                        }
                        else
                        {
                            <option value="@acc">@acc</option>
                        }
                    }
                </select>

                <button type="submit" class="btn" style="background:#1a4919; color:white; width:150px; margin-top:10px;">SELL</button>
            </form>
            @if (!string.IsNullOrEmpty(vm.ErrorMessage))
            {
                <span style="color:darkred; margin-top:10px;">@vm.ErrorMessage</span>
            }
        </div>
    </div>
</div>
